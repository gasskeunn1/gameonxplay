<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Live - GameOnXtv</title>
  <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body {
      background-color: #0d1117;
      color: white;
      font-family: sans-serif;
    }
    .blink {
      animation: blink-animation 1s steps(2, start) infinite;
    }
        .container {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
      gap: 15px;
    }

    .card {
      background-color: #222;
      border-radius: 10px;
      overflow: hidden;
      box-shadow: 0 2px 10px rgba(0,0,0,0.5);
      transition: transform 0.2s ease;
    }

    .card:hover {
      transform: scale(1.03);
    }

    .card a {
      display: block;
      color: #fff;
      text-decoration: none;
      padding: 10px;
    }

    .card img {
      width: 100%;
      height: auto;
      display: block;
    }

    .card small {
      display: block;
      margin-top: 5px;
      color: #ccc;
    }
    @keyframes blink-animation {
      to {
        visibility: hidden;
      }
    }
  </style>
</head>
<body class="min-h-screen flex flex-col">

  <!-- Header -->
  <header class="flex justify-between items-center px-4 py-3 bg-[#161b22] shadow">
    <div class="flex items-center space-x-3">
      <img src="assets/logo.png" alt="Logo" class="h-8">
    </div>
    <nav class="flex space-x-4">
      <a href="index.html" class="text-white hover:text-blue-400">Home</a>
      <a href="#" class="text-white hover:text-blue-400">Donasi</a>
      <a href="#" class="text-white hover:text-blue-400">Group</a>
    </nav>
  </header>

  <!-- Judul -->
  <h1 class="text-2xl font-bold mt-6 mb-3 px-4">Live</h1>

  <!-- Video Player -->
  <div class="aspect-video bg-black max-w-6xl mx-auto w-full mb-6">
    <video id="video" controls class="w-full h-full"></video>
  </div>

  <!-- Daftar Channel -->
  <div id="channel-list" class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4 px-4 pb-10"></div>

  <script>
    const video = document.getElementById("video");
    let hls;

    function loadStream(src) {
      if (hls) {
        hls.destroy();
      }

      hls = new Hls();
      hls.loadSource(src);
      hls.attachMedia(video);

      hls.on(Hls.Events.ERROR, function (event, data) {
        if (data.fatal) {
          setTimeout(() => loadStream(src), 3000); // reload after 3s
        }
      });
    }

    function convertToLocalTime(jadwal) {
      const options = { weekday: 'short', day: '2-digit', month: 'short', hour: '2-digit', minute: '2-digit', hour12: false, timeZone: 'Asia/Jakarta' };
      const waktu = new Date(jadwal + ' GMT+7');
      const wib = waktu.toLocaleString('id-ID', options) + ' WIB';

      const wita = new Date(waktu.getTime() + 60 * 60 * 1000).toLocaleString('id-ID', options) + ' WITA';
      const wit = new Date(waktu.getTime() + 2 * 60 * 60 * 1000).toLocaleString('id-ID', options) + ' WIT';

      const userTime = new Date().getTimezoneOffset();
      if (userTime === -420) return wib; // WIB
      else if (userTime === -480) return wita; // WITA
      else return wit; // default WIT
    }

    function isLive(jadwal) {
      return new Date() >= new Date(jadwal + ' GMT+7');
    }

    fetch("data/live.json")
      .then(res => res.json())
      .then(data => {
        data.sort((a, b) => new Date(a.jadwal) - new Date(b.jadwal));
        const container = document.getElementById("channel-list");
        data.forEach(channel => {
          const div = document.createElement("div");
          div.className = "bg-[#1c1f26] rounded-lg shadow-lg overflow-hidden text-white flex flex-col";

          const waktu = convertToLocalTime(channel.jadwal);
          const liveNow = isLive(channel.jadwal);

          div.innerHTML = `
            <img src="${channel.poster}" alt="${channel.name}" class="w-full h-48 object-cover">
            <div class="p-4 flex flex-col flex-grow">
              <h2 class="text-sm font-semibold leading-snug mb-2">${channel.name}</h2>
              <p class="text-sm text-gray-400 mb-4">
                ${liveNow ? '<span class="text-red-500 blink">ðŸ”´ LIVE</span>' : waktu}
              </p>
              <button class="mt-auto bg-red-600 hover:bg-red-700 text-white py-2 rounded transition" onclick="loadStream('${channel.src}')">Tonton</button>
            </div>
          `;
          container.appendChild(div);
        });
      });
  </script>
</body>
</html>
